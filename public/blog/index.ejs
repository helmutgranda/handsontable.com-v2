<%
function catList(data) {
    var cats = {};
    for (var key in data) {
        var category = data[key].category;
        if (!(category in cats)) {
            cats[category] = [];
        }
        cats[category].push(data[key]);
        //copy the key itself as a slug
        cats[category][cats[category].length - 1]["slug"] = key;
    }
    //you could alpha sort the cats
    return cats;
}
%>

<section class="blog">
    <div class="row">
        <div class="large-12 large-centered columns">
            <h2 class="headline">Blog</h2>
        </div>
    </div>

    <%- partial("_form.ejs") %>

    <div class="row">
        <div class="large-12 large-centered columns">
            <div class="row">
                <div class="large-4 columns categories">
                    <h3>Categories</h3>
                    <ul>
                        <li>
                            <a href="/blog/categories/community">Community</a>
                        </li>
                        <li>
                            <a href="/blog/categories/culture">Culture</a>
                        </li>
                        <li>
                            <a href="/blog/categories/news">News</a>
                        </li>
                        <li>
                            <a href="/blog/categories/recipes">Recipes</a>
                        </li>
                        <li>
                            <a href="/blog/categories/startups">Startups</a>
                        </li>
                        <li>
                            <a href="/blog/categories/tools">Tools</a>
                        </li>
                        <li>
                            <a href="/blog/categories/all">All</a>
                        </li>
                    </ul>
                </div>
                <% var i = 0;
                %>

                <% for(var slug in public.blog.posts._data) {
                    if (i > 4) {
                        break;
                    }
                %>
                    <div class="large-4 columns post-element">
                        <h3>
                            <a href="/blog/posts/<%= slug %>"><%= public.blog.posts._data[slug].title %></a>
                        </h3>
                        <p>
                            <small>
                                <%= public.blog.posts._data[slug].category %> / <%= public.blog.posts._data[slug].date %>
                            </small>
                        </p>
                        <p><%= public.blog.posts._data[slug].description %></p>
                        <p><a href="/blog/posts/<%= slug %>">Read more</a></p>
                    </div>
                <% i++; }; %>
            </div>
        </div>
    </div>
</section>